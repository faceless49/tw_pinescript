<!-- public/index.html -->
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Excel → Pine</title>
  <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; padding: 24px; }
      #log { margin-top: 12px; color: #666; white-space: pre-wrap; }
  </style>
</head>
<body>
<h1>Excel → Pine</h1>
<input id="file" type="file" accept=".xlsx,.xls" />
<button id="btn">Загрузить Excel и получить .pine</button>
<div id="log"></div>

<script>
  const log = (m) => (document.getElementById('log').textContent = m);
  document.getElementById('btn').onclick = async () => {
    const f = document.getElementById('file').files[0];
    if (!f) { log('Выберите .xlsx/.xls'); return; }
    log('Загружаю…');

    const fd = new FormData();
    fd.append('file', f);

    try {
      const resp = await fetch('/generate-pine-script', { method: 'POST', body: fd });
      if (!resp.ok) {
        const text = await resp.text().catch(()=>'');
        throw new Error(text || ('HTTP ' + resp.status));
      }
      const blob = await resp.blob();
      // Имя из заголовка или дефолт
      const cd = resp.headers.get('Content-Disposition') || '';
      const match = /filename="?([^"]+)"?/.exec(cd);
      const filename = match?.[1] || 'generated_pine_script.pine';

      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), { href: url, download: filename });
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
      log('Готово ✅');
    } catch (e) {
      log('Ошибка: ' + e.message);
    }
  };
</script>
</body>
</html>
